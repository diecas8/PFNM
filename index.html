<script>
    var fincasAgregadas = new Set(); // Para evitar duplicados

    function cargarGeoJSON(url, estilo, nombreCapa, etiquetar = false) {
        fetch(url)
            .then(response => response.json())
            .then(data => {
                geojsonData = data;
                var layer = L.geoJSON(data, {
                    style: estilo,
                    onEachFeature: function(feature, layer) {
                        if (feature.properties) {
                            const codFinca = feature.properties.cod_finca || "N/A";
                            const nombreFinca = feature.properties.nom_finca_ || "Sin nombre";
                            const fincaLabel = `${codFinca} - ${nombreFinca}`;

                            if (etiquetar && !fincasAgregadas.has(fincaLabel)) {
                                // Agregar solo si no estÃ¡ en el conjunto
                                fincasAgregadas.add(fincaLabel);

                                const option = document.createElement('option');
                                option.value = codFinca;
                                option.textContent = fincaLabel;
                                fincaSelector.appendChild(option);
                            }
                        }
                    }
                });
                layer.addTo(map);
                layerControl.addOverlay(layer, nombreCapa);
                bounds.extend(layer.getBounds());
                map.fitBounds(bounds);
            })
            .catch(error => console.error(`Error cargando ${nombreCapa}:`, error));
    }
</script>
